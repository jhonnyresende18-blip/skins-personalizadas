<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Skins Personalizadas | Plataforma Oficial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --p:#00ffd5;--bg:#0b0b0b;--c:#151515;--b:#242424;--t:#eee;--m:#999
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Arial,Helvetica,sans-serif;
  background:radial-gradient(circle at top,#111,#000);color:var(--t)
}
header{text-align:center;padding:28px;border-bottom:1px solid var(--b)}
header h1{margin:0;color:var(--p)}
header p{margin-top:6px;color:var(--m);font-size:14px}

.container{max-width:1200px;margin:40px auto;padding:0 16px}
.card{
  background:var(--c);border:1px solid var(--b);
  border-radius:14px;padding:24px;margin-bottom:24px
}
h2{margin-top:0}
input,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:8px;font-size:14px;border:none
}
input{background:#0f0f0f;color:#fff;border:1px solid #333}
button{background:var(--p);color:#000;font-weight:600;cursor:pointer}
button:hover{opacity:.9}
.preview{
  width:260px;height:260px;margin:20px auto;border-radius:50%;
  border:10px solid var(--p);background:#000;
  background-size:cover;background-position:center
}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px}
.hidden{display:none}
.admin{border:1px dashed var(--p)}
footer{
  text-align:center;font-size:12px;color:#777;
  padding:30px;border-top:1px solid var(--b)
}
a{color:var(--p);word-break:break-all}
</style>
</head>

<body>

<header>
  <h1>Skins Personalizadas</h1>
  <p>Crie skins PNG e use diretamente no Agar.io</p>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h2>Login / Cadastro</h2>
  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha (mín. 6 caracteres)">
  <button onclick="login()">Entrar</button>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

<div class="grid">

<!-- EDITOR -->
<div class="card">
  <h2>Editor de Skin</h2>
  <div id="preview" class="preview"></div>
  <input type="file" accept="image/png" onchange="carregarSkin(event)">
  <input type="color" value="#00ffd5" onchange="mudarBorda(this.value)">
  <input type="range" min="2" max="25" value="10" onchange="mudarEspessura(this.value)">
  <button onclick="salvarSkin()">Salvar Skin</button>
</div>

<!-- CONTA -->
<div class="card">
  <h2>Sua Conta</h2>
  <p>Créditos: <strong id="creditos">0</strong></p>
  <p>Suas skins:</p>
  <div id="skinsList"></div>
</div>

<!-- COMPRA -->
<div class="card">
  <h2>Comprar Créditos</h2>
  <p><strong>R$ 7,99</strong> — 10 edições</p>
  <p>
    PIX: <strong>jhonnyresende18@gmail.com</strong><br>
    Beneficiário: SkinsPersonalizadas
  </p>
  <button onclick="confirmarPagamento()">Confirmar pagamento</button>
</div>

</div>

<!-- ADMIN -->
<div id="adminBox" class="card admin hidden">
  <h2>Painel Admin</h2>
  <div id="adminPayments"></div>
</div>

</div>

<footer>
Skins Personalizadas não é afiliado ao Agar.io.<br>
Uso via link PNG.
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,doc,setDoc,getDoc,addDoc,collection,serverTimestamp,getDocs,updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage,ref,uploadString,getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const ADMIN_EMAIL="jhonnyresende18@gmail.com";

const firebaseConfig={
 apiKey:"AIzaSyBXRWZ-FEqZ4NI3AFtSXZu5XpvxdIuiN9U",
 authDomain:"skins-personalizadas.firebaseapp.com",
 projectId:"skins-personalizadas",
 storageBucket:"skins-personalizadas.firebasestorage.app",
 messagingSenderId:"987599508308",
 appId:"1:987599508308:web:112bfe0d4030d6666aaec1"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);

let currentImage=null;

// LOGIN
window.login=async()=>{
 const email=document.getElementById("email").value;
 const senha=document.getElementById("senha").value;
 try{
  const c=await signInWithEmailAndPassword(auth,email,senha);
  loadUser(c.user);
 }catch{
  const c=await createUserWithEmailAndPassword(auth,email,senha);
  await setDoc(doc(db,"users",c.user.uid),{
    email,creditos:0,criadoEm:serverTimestamp()
  });
  loadUser(c.user);
 }
};

onAuthStateChanged(auth,u=>u&&loadUser(u));

async function loadUser(u){
 loginBox.classList.add("hidden");
 appBox.classList.remove("hidden");

 const snap=await getDoc(doc(db,"users",u.uid));
 if(snap.exists()) creditos.innerText=snap.data().creditos;

 carregarSkins(u.uid);

 if(u.email===ADMIN_EMAIL){
  adminBox.classList.remove("hidden");
  carregarPagamentos();
 }
}

// EDITOR
window.carregarSkin=e=>{
 const f=e.target.files[0];
 if(!f||f.type!=="image/png") return alert("Apenas PNG");
 const r=new FileReader();
 r.onload=()=>{
  currentImage=r.result;
  preview.style.backgroundImage=`url(${r.result})`;
 };
 r.readAsDataURL(f);
};

window.mudarBorda=c=>preview.style.borderColor=c;
window.mudarEspessura=v=>preview.style.borderWidth=v+"px";

// SALVAR SKIN
window.salvarSkin=async()=>{
 const u=auth.currentUser;
 if(!u) return alert("Faça login");
 if(!currentImage) return alert("Envie uma imagem");

 const snap=await getDoc(doc(db,"users",u.uid));
 if(snap.data().creditos<=0) return alert("Sem créditos");

 const id=Date.now().toString();
 const storageRef=ref(storage,`skins/${u.uid}/${id}.png`);
 await uploadString(storageRef,currentImage,"data_url");
 const url=await getDownloadURL(storageRef);

 await addDoc(collection(db,"skins"),{
  user:u.uid,url,criadoEm:serverTimestamp()
 });

 await updateDoc(doc(db,"users",u.uid),{
  creditos:snap.data().creditos-1
 });

 creditos.innerText=snap.data().creditos-1;
 carregarSkins(u.uid);
 alert("Skin salva! Use o link no Agar.io");
};

// LISTAR SKINS
async function carregarSkins(uid){
 skinsList.innerHTML="";
 const q=await getDocs(collection(db,"skins"));
 q.forEach(d=>{
  const s=d.data();
  if(s.user===uid){
   skinsList.innerHTML+=`<p><a href="${s.url}" target="_blank">${s.url}</a></p>`;
  }
 });
}

// PAGAMENTO
window.confirmarPagamento=async()=>{
 const u=auth.currentUser;
 if(!u) return alert("Faça login");
 await addDoc(collection(db,"payments"),{
  user:u.uid,valor:7.99,status:"pendente",criadoEm:serverTimestamp()
 });
 alert("Pagamento enviado para verificação");
};

// ADMIN
async function carregarPagamentos(){
 const q=await getDocs(collection(db,"payments"));
 adminPayments.innerHTML="";
 q.forEach(d=>{
  const p=d.data();
  if(p.status==="pendente"){
   adminPayments.innerHTML+=`
    <p>
     UID: ${p.user} | R$ ${p.valor}
     <button onclick="aprovar('${d.id}','${p.user}')">Aprovar</button>
    </p>`;
  }
 });
}

window.aprovar=async(pid,uid)=>{
 await updateDoc(doc(db,"payments",pid),{status:"aprovado"});
 const uref=doc(db,"users",uid);
 const usnap=await getDoc(uref);
 await updateDoc(uref,{creditos:(usnap.data().creditos||0)+10});
 alert("Créditos liberados");
 carregarPagamentos();
};
</script>

</body>
</html>
